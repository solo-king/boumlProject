<?xml version="1.0" encoding="UTF-8"?>
<!-- Documentation produced by the Html generator of Bouml (http://www.bouml.fr) -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:svg="http://www.w3.org/2000/svg">

<head>
<title>Class SensorService::SensorEventConnection</title>
<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body bgcolor="#ffffff">

<div class = "title">Class SensorService::SensorEventConnection</div>
<p></p>

<!-- ============================================================= -->

<a name="ref4_139650"></a>
<p>Declaration :</p><ul>
<li>C++ : class SensorService::SensorEventConnection : public <a href="class139138.html#ref4_139138"><b>typedef16</b></a>, public <a href="class139778.html#ref4_139778"><b>typedef18</b></a> </li><li>Java : package class SensorService::SensorEventConnection extends <a href="class139138.html#ref4_139138"><b>typedef16</b></a> implements <a href="class139778.html#ref4_139778"><b>typedef18</b></a> </li></ul><p>Artifact : <a href="index.html#ref8_131842"><b>SensorEventConnection</b></a></p>
<div class="sub">
<a name="ref2_160386"></a>
<table><tr><td><div class="element">Operation <b>sendEvents</b></div></td></tr></table><p>Declaration :</p><ul><li>Uml : + sendEvents(in buffer : sensors_event_t, in numEvents : size_t, inout scratch : sensors_event_t, in mapFlushEventsToConnections : wp&lt;const SensorEventConnection&gt; = NULL) : status_t</li><li>C++ : public: status_t sendEvents(const sensors_event_t * buffer, size_t numEvents, sensors_event_t * scratch, const wp&lt;const SensorEventConnection&gt; * mapFlushEventsToConnections = NULL)</li><li>Java : public status_t sendEvents()</li></ul><a name="ref2_160514"></a>
<table><tr><td><div class="element">Operation <b>hasSensor</b></div></td></tr></table><p>Declaration :</p><ul><li>Uml : + hasSensor(in handle : int32_t) : bool</li><li>C++ : public: bool hasSensor(int32_t handle) const</li><li>Java : public boolean hasSensor()</li></ul><a name="ref2_160642"></a>
<table><tr><td><div class="element">Operation <b>hasAnySensor</b></div></td></tr></table><p>Declaration :</p><ul><li>Uml : + hasAnySensor() : bool</li><li>C++ : public: bool hasAnySensor() const</li><li>Java : public boolean hasAnySensor()</li></ul><a name="ref2_160770"></a>
<table><tr><td><div class="element">Operation <b>hasOneShotSensors</b></div></td></tr></table><p>Declaration :</p><ul><li>Uml : + hasOneShotSensors() : bool</li><li>C++ : public: bool hasOneShotSensors() const</li><li>Java : public boolean hasOneShotSensors()</li></ul><a name="ref2_160898"></a>
<table><tr><td><div class="element">Operation <b>addSensor</b></div></td></tr></table><p>Declaration :</p><ul><li>Uml : + addSensor(in handle : int32_t) : bool</li><li>C++ : public: bool addSensor(int32_t handle)</li><li>Java : public boolean addSensor()</li></ul><a name="ref2_161026"></a>
<table><tr><td><div class="element">Operation <b>removeSensor</b></div></td></tr></table><p>Declaration :</p><ul><li>Uml : + removeSensor(in handle : int32_t) : bool</li><li>C++ : public: bool removeSensor(int32_t handle)</li><li>Java : public boolean removeSensor()</li></ul><a name="ref2_161154"></a>
<table><tr><td><div class="element">Operation <b>setFirstFlushPending</b></div></td></tr></table><p>Declaration :</p><ul><li>Uml : + setFirstFlushPending(in handle : int32_t, in value : bool) : void</li><li>C++ : public: void setFirstFlushPending(int32_t handle, bool value)</li><li>Java : public void setFirstFlushPending()</li></ul><a name="ref2_161282"></a>
<table><tr><td><div class="element">Operation <b>dump</b></div></td></tr></table><p>Declaration :</p><ul><li>Uml : + dump(inout result : String8) : void</li><li>C++ : public: void dump(String8 &amp; result)</li><li>Java : public void dump()</li></ul><a name="ref2_161410"></a>
<table><tr><td><div class="element">Operation <b>needsWakeLock</b></div></td></tr></table><p>Declaration :</p><ul><li>Uml : + needsWakeLock() : bool</li><li>C++ : public: bool needsWakeLock()</li><li>Java : public boolean needsWakeLock()</li></ul><a name="ref2_161538"></a>
<table><tr><td><div class="element">Operation <b>resetWakeLockRefCount</b></div></td></tr></table><p>Declaration :</p><ul><li>Uml : + resetWakeLockRefCount() : void</li><li>C++ : public: void resetWakeLockRefCount()</li><li>Java : public void resetWakeLockRefCount()</li></ul><a name="ref2_161666"></a>
<table><tr><td><div class="element">Operation <b>getPackageName</b></div></td></tr></table><p>Declaration :</p><ul><li>Uml : + getPackageName() : String8</li><li>C++ : public: String8 getPackageName() const</li><li>Java : public String8 getPackageName()</li></ul><a name="ref2_161794"></a>
<table><tr><td><div class="element">Operation <b>getUid</b></div></td></tr></table><p>Declaration :</p><ul><li>Uml : + getUid() : uid_t</li><li>C++ : public: inline uid_t getUid() const</li><li>Java : public uid_t getUid()</li></ul><a name="ref2_161922"></a>
<table><tr><td><div class="element">Operation <b>setSensorAccess</b></div></td></tr></table><p>Declaration :</p><ul><li>Uml : + setSensorAccess(in hasAccess : bool) : void</li><li>C++ : public: void setSensorAccess(const bool hasAccess)</li><li>Java : public void setSensorAccess()</li></ul><a name="ref2_162050"></a>
<table><tr><td><div class="element">Operation <b>onFirstRef</b></div></td></tr></table><p>Declaration :</p><ul><li>Uml : - onFirstRef() : void</li><li>C++ : private: virtual void onFirstRef()</li><li>Java : private void onFirstRef()</li></ul><a name="ref2_162178"></a>
<table><tr><td><div class="element">Operation <b>getSensorChannel</b></div></td></tr></table><p>Declaration :</p><ul><li>Uml : - getSensorChannel() : sp&lt;BitTube&gt;</li><li>C++ : private: virtual sp&lt;BitTube&gt; getSensorChannel() const</li><li>Java : private sp&lt;BitTube&gt; getSensorChannel()</li></ul><a name="ref2_162306"></a>
<table><tr><td><div class="element">Operation <b>enableDisable</b></div></td></tr></table><p>Declaration :</p><ul><li>Uml : - enableDisable(in handle : int, in enabled : bool, in samplingPeriodNs : nsecs_t, in maxBatchReportLatencyNs : nsecs_t, in reservedFlags : int) : status_t</li><li>C++ : private: virtual status_t enableDisable(int handle, bool enabled, nsecs_t samplingPeriodNs, nsecs_t maxBatchReportLatencyNs, int reservedFlags)</li><li>Java : private status_t enableDisable()</li></ul><a name="ref2_162434"></a>
<table><tr><td><div class="element">Operation <b>setEventRate</b></div></td></tr></table><p>Declaration :</p><ul><li>Uml : - setEventRate(in handle : int, in samplingPeriodNs : nsecs_t) : status_t</li><li>C++ : private: virtual status_t setEventRate(int handle, nsecs_t samplingPeriodNs)</li><li>Java : private status_t setEventRate()</li></ul><a name="ref2_162562"></a>
<table><tr><td><div class="element">Operation <b>flush</b></div></td></tr></table><p>Declaration :</p><ul><li>Uml : - flush() : status_t</li><li>C++ : private: virtual status_t flush()</li><li>Java : private status_t flush()</li></ul><a name="ref2_162690"></a>
<table><tr><td><div class="element">Operation <b>configureChannel</b></div></td></tr></table><p>Declaration :</p><ul><li>Uml : - configureChannel(in handle : int, in rateLevel : int) : int32_t</li><li>C++ : private: virtual int32_t configureChannel(int handle, int rateLevel)</li><li>Java : private int32_t configureChannel()</li></ul><a name="ref2_162818"></a>
<table><tr><td><div class="element">Operation <b>destroy</b></div></td></tr></table><p>Declaration :</p><ul><li>Uml : - destroy() : void</li><li>C++ : private: virtual void destroy()</li><li>Java : private void destroy()</li></ul><a name="ref2_162946"></a>
<table><tr><td><div class="element">Operation <b>countFlushCompleteEventsLocked</b></div></td></tr></table><p>Count the number of flush complete events which are about to be dropped in the buffer.<br /> Increment mPendingFlushEventsToSend in mSensorInfo. These flush complete events will be sent<br /> separately before the next batch of events.<br /></p><p>Declaration :</p><ul><li>Uml : - countFlushCompleteEventsLocked(in scratch : sensors_event_t, in numEventsDropped : int) : void</li><li>C++ : private: void countFlushCompleteEventsLocked(const sensors_event_t * scratch, int numEventsDropped)</li><li>Java : private void countFlushCompleteEventsLocked()</li></ul><a name="ref2_163074"></a>
<table><tr><td><div class="element">Operation <b>findWakeUpSensorEventLocked</b></div></td></tr></table><p>Check if there are any wake up events in the buffer. If yes, return the index of the first<br /> wake_up sensor event in the buffer else return -1.  This wake_up sensor event will have the<br /> flag WAKE_UP_SENSOR_EVENT_NEEDS_ACK set. Exactly one event per packet will have the wake_up<br /> flag set. SOCK_SEQPACKET ensures that either the entire packet is read or dropped.<br /></p><p>Declaration :</p><ul><li>Uml : - findWakeUpSensorEventLocked(in scratch : sensors_event_t, in count : int) : int</li><li>C++ : private: int findWakeUpSensorEventLocked(const sensors_event_t * scratch, int count)</li><li>Java : private int findWakeUpSensorEventLocked()</li></ul><a name="ref2_163202"></a>
<table><tr><td><div class="element">Operation <b>sendPendingFlushEventsLocked</b></div></td></tr></table><p>Send pending flush_complete events. There may have been flush_complete_events that are<br /> dropped which need to be sent separately before other events. On older HALs (1_0) this method<br /> emulates the behavior of flush().<br /></p><p>Declaration :</p><ul><li>Uml : - sendPendingFlushEventsLocked() : void</li><li>C++ : private: void sendPendingFlushEventsLocked()</li><li>Java : private void sendPendingFlushEventsLocked()</li></ul><a name="ref2_163330"></a>
<table><tr><td><div class="element">Operation <b>writeToSocketFromCache</b></div></td></tr></table><p>Writes events from mEventCache to the socket.<br /></p><p>Declaration :</p><ul><li>Uml : - writeToSocketFromCache() : void</li><li>C++ : private: void writeToSocketFromCache()</li><li>Java : private void writeToSocketFromCache()</li></ul><a name="ref2_163458"></a>
<table><tr><td><div class="element">Operation <b>computeMaxCacheSizeLocked</b></div></td></tr></table><p>Compute the approximate cache size from the FIFO sizes of various sensors registered for this<br /> connection. Wake up and non-wake up sensors have separate FIFOs but FIFO may be shared<br /> amongst wake-up sensors and non-wake up sensors.<br /></p><p>Declaration :</p><ul><li>Uml : - computeMaxCacheSizeLocked() : int</li><li>C++ : private: int computeMaxCacheSizeLocked() const</li><li>Java : private int computeMaxCacheSizeLocked()</li></ul><a name="ref2_163586"></a>
<table><tr><td><div class="element">Operation <b>reAllocateCacheLocked</b></div></td></tr></table><p>When more sensors register, the maximum cache size desired may change.  Compute max cache<br /> size, reallocate memory and copy over events from the older cache.<br /></p><p>Declaration :</p><ul><li>Uml : - reAllocateCacheLocked(in scratch : sensors_event_t, in count : int) : void</li><li>C++ : private: void reAllocateCacheLocked(const sensors_event_t * scratch, int count)</li><li>Java : private void reAllocateCacheLocked()</li></ul><a name="ref2_163714"></a>
<table><tr><td><div class="element">Operation <b>handleEvent</b></div></td></tr></table><p>LooperCallback method. If there is data to read on this fd, it is an ack from the app that it<br /> has read events from a wake up sensor, decrement mWakeLockRefCount.  If this fd is available<br /> for writing send the data from the cache.<br /></p><p>Declaration :</p><ul><li>Uml : - handleEvent(in fd : int, in events : int, inout data : void) : int</li><li>C++ : private: virtual int handleEvent(int fd, int events, void * data)</li><li>Java : private int handleEvent()</li></ul><a name="ref2_163842"></a>
<table><tr><td><div class="element">Operation <b>incrementPendingFlushCount</b></div></td></tr></table><p>Increment mPendingFlushEventsToSend for the given sensor handle.<br /></p><p>Declaration :</p><ul><li>Uml : - incrementPendingFlushCount(in handle : int32_t) : void</li><li>C++ : private: void incrementPendingFlushCount(int32_t handle)</li><li>Java : private void incrementPendingFlushCount()</li></ul><a name="ref2_163970"></a>
<table><tr><td><div class="element">Operation <b>updateLooperRegistration</b></div></td></tr></table><p>Add or remove the file descriptor associated with the BitTube to the looper. If mDead is set<br /> to true or there are no more sensors for this connection, the file descriptor is removed if<br /> it has been previously added to the Looper. Depending on the state of the connection FD may<br /> be added to the Looper. The flags to set are determined by the internal state of the<br /> connection. FDs are added to the looper when wake-up sensors are registered (to poll for<br /> acknowledgements) and when write fails on the socket when there are too many error and the<br /> other end hangs up or when this client unregisters for this connection.<br /></p><p>Declaration :</p><ul><li>Uml : - updateLooperRegistration(in looper : sp&lt;Looper&gt;) : void</li><li>C++ : private: void updateLooperRegistration(const sp&lt;Looper&gt; &amp; looper)</li><li>Java : private void updateLooperRegistration()</li></ul><a name="ref2_164098"></a>
<table><tr><td><div class="element">Operation <b>updateLooperRegistrationLocked</b></div></td></tr></table><p>Declaration :</p><ul><li>Uml : - updateLooperRegistrationLocked(in looper : sp&lt;Looper&gt;) : void</li><li>C++ : private: void updateLooperRegistrationLocked(const sp&lt;Looper&gt; &amp; looper)</li><li>Java : private void updateLooperRegistrationLocked()</li></ul><a name="ref0_136450"></a>
<table><tr><td><div class="element">Relation <b>mService (&lt;directional composition&gt;)</b></div></td></tr></table><p>Declaration :</p><ul><li>Uml : - mService : <a href="class139266.html#ref4_139266"><b>SensorService</b></a>, read only</li><li>C++ : private: const sp&lt;<a href="class139266.html#ref4_139266"><b>SensorService</b></a>&gt; mService</li><li>Java : private final <a href="class139266.html#ref4_139266"><b>SensorService</b></a> mService</li></ul><p>Stereotype: sp</p>
<a name="ref1_140162"></a>
<table><tr><td><div class="element">Attribute <b>mChannel</b></div></td></tr></table>
<p>Declaration :</p><ul><li>Uml : - mChannel : BitTube</li><li>C++ : private: sp&lt;BitTube&gt; mChannel</li><li>Java : private BitTube mChannel</li></ul><p>Stereotype: sp</p>
<a name="ref1_140290"></a>
<table><tr><td><div class="element">Attribute <b>mUid</b></div></td></tr></table>
<p>Declaration :</p><ul><li>Uml : - mUid : uid_t</li><li>C++ : private: uid_t mUid</li><li>Java : private uid_t mUid</li></ul><a name="ref1_140418"></a>
<table><tr><td><div class="element">Attribute <b>mConnectionLock</b></div></td></tr></table>
<p>Declaration :</p><ul><li>Uml : - mConnectionLock : Mutex</li><li>C++ : private: mutable Mutex mConnectionLock</li><li>Java : private Mutex mConnectionLock</li></ul><a name="ref1_140546"></a>
<table><tr><td><div class="element">Attribute <b>mWakeLockRefCount</b></div></td></tr></table>
<p>Number of events from wake up sensors which are still pending and haven't been delivered to<br /> the corresponding application. It is incremented by one unit for each write to the socket.<br /><br /></p><p>Declaration :</p><ul><li>Uml : - mWakeLockRefCount : uint32_t</li><li>C++ : private: uint32_t mWakeLockRefCount</li><li>Java : private uint32_t mWakeLockRefCount</li></ul><a name="ref1_140674"></a>
<table><tr><td><div class="element">Attribute <b>mHasLooperCallbacks</b></div></td></tr></table>
<p>If this flag is set to true, it means that the file descriptor associated with the BitTube<br /> has been added to the Looper in SensorService. This flag is typically set when this<br /> connection has wake-up sensors associated with it or when write has failed on this connection<br /> and we're storing some events in the cache.<br /><br /></p><p>Declaration :</p><ul><li>Uml : - mHasLooperCallbacks : bool</li><li>C++ : private: bool mHasLooperCallbacks</li><li>Java : private boolean mHasLooperCallbacks</li></ul><a name="ref1_140802"></a>
<table><tr><td><div class="element">Attribute <b>mDead</b></div></td></tr></table>
<p>If there are any errors associated with the Looper this flag is set to true and<br /> mWakeLockRefCount is reset to zero. needsWakeLock method will always return false, if this<br /> flag is set.<br /><br /></p><p>Declaration :</p><ul><li>Uml : - mDead : bool</li><li>C++ : private: bool mDead</li><li>Java : private boolean mDead</li></ul><a name="ref1_140930"></a>
<table><tr><td><div class="element">Attribute <b>mDataInjectionMode</b></div></td></tr></table>
<p>Declaration :</p><ul><li>Uml : - mDataInjectionMode : bool</li><li>C++ : private: bool mDataInjectionMode</li><li>Java : private boolean mDataInjectionMode</li></ul><table><tr><td><div class="element">Class <b><a href="class139906.html#ref4_139906"><b>FlushInfo</b></a></b></div></td></tr></table>
<a name="ref0_136578"></a>
<table><tr><td><div class="element">Relation <b>mSensorInfo (&lt;directional composition&gt;)</b></div></td></tr></table><p>protected by SensorService::mLock. Key for this vector is the sensor handle.<br /><br /></p><p>Declaration :</p><ul><li>Uml : - mSensorInfo : <a href="class139906.html#ref4_139906"><b>FlushInfo</b></a></li><li>C++ : private: KeyedVector&lt;int,<a href="class139906.html#ref4_139906"><b>FlushInfo</b></a>&gt; mSensorInfo</li><li>Java : private <a href="class139906.html#ref4_139906"><b>FlushInfo</b></a> mSensorInfo</li></ul><p>Stereotype: KeyedVector</p>
<a name="ref1_141314"></a>
<table><tr><td><div class="element">Attribute <b>mEventCache</b></div></td></tr></table>
<p>Declaration :</p><ul><li>Uml : - mEventCache : sensors_event_t</li><li>C++ : private: sensors_event_t * mEventCache</li><li>Java : private sensors_event_t mEventCache</li></ul><a name="ref1_141442"></a>
<table><tr><td><div class="element">Attribute <b>mCacheSize</b></div></td></tr></table>
<p>Declaration :</p><ul><li>Uml : - mCacheSize : int</li><li>C++ : private: int mCacheSize</li><li>Java : private int mCacheSize</li></ul><a name="ref1_141570"></a>
<table><tr><td><div class="element">Attribute <b>mMaxCacheSize</b></div></td></tr></table>
<p>Declaration :</p><ul><li>Uml : - mMaxCacheSize : int</li><li>C++ : private: int mMaxCacheSize</li><li>Java : private int mMaxCacheSize</li></ul><a name="ref1_141698"></a>
<table><tr><td><div class="element">Attribute <b>mPackageName</b></div></td></tr></table>
<p>Declaration :</p><ul><li>Uml : - mPackageName : String8</li><li>C++ : private: String8 mPackageName</li><li>Java : private String8 mPackageName</li></ul><a name="ref1_141826"></a>
<table><tr><td><div class="element">Attribute <b>mOpPackageName</b></div></td></tr></table>
<p>Declaration :</p><ul><li>Uml : - mOpPackageName : String16, read only</li><li>C++ : private: const String16 mOpPackageName</li><li>Java : private final String16 mOpPackageName</li></ul><a name="ref1_141954"></a>
<table><tr><td><div class="element">Attribute <b>mEventsReceived</b></div></td></tr></table>
<p>Declaration :</p><ul><li>Uml : - mEventsReceived : int</li><li>C++ : private: int mEventsReceived</li><li>Java : private int mEventsReceived</li></ul><a name="ref1_142082"></a>
<table><tr><td><div class="element">Attribute <b>mEventsSent</b></div></td></tr></table>
<p>Declaration :</p><ul><li>Uml : - mEventsSent : int</li><li>C++ : private: int mEventsSent</li><li>Java : private int mEventsSent</li></ul><a name="ref1_142210"></a>
<table><tr><td><div class="element">Attribute <b>mEventsSentFromCache</b></div></td></tr></table>
<p>Declaration :</p><ul><li>Uml : - mEventsSentFromCache : int</li><li>C++ : private: int mEventsSentFromCache</li><li>Java : private int mEventsSentFromCache</li></ul><a name="ref1_142338"></a>
<table><tr><td><div class="element">Attribute <b>mTotalAcksNeeded</b></div></td></tr></table>
<p>Declaration :</p><ul><li>Uml : - mTotalAcksNeeded : int</li><li>C++ : private: int mTotalAcksNeeded</li><li>Java : private int mTotalAcksNeeded</li></ul><a name="ref1_142466"></a>
<table><tr><td><div class="element">Attribute <b>mTotalAcksReceived</b></div></td></tr></table>
<p>Declaration :</p><ul><li>Uml : - mTotalAcksReceived : int</li><li>C++ : private: int mTotalAcksReceived</li><li>Java : private int mTotalAcksReceived</li></ul><a name="ref1_142594"></a>
<table><tr><td><div class="element">Attribute <b>mDestroyLock</b></div></td></tr></table>
<p>Declaration :</p><ul><li>Uml : - mDestroyLock : Mutex</li><li>C++ : private: mutable Mutex mDestroyLock</li><li>Java : private Mutex mDestroyLock</li></ul><a name="ref1_142722"></a>
<table><tr><td><div class="element">Attribute <b>mDestroyed</b></div></td></tr></table>
<p>Declaration :</p><ul><li>Uml : - mDestroyed : bool</li><li>C++ : private: bool mDestroyed</li><li>Java : private boolean mDestroyed</li></ul><a name="ref1_142850"></a>
<table><tr><td><div class="element">Attribute <b>mHasSensorAccess</b></div></td></tr></table>
<p>Declaration :</p><ul><li>Uml : - mHasSensorAccess : bool</li><li>C++ : private: bool mHasSensorAccess</li><li>Java : private boolean mHasSensorAccess</li></ul></div>
<p>All public operations : <a href="class139650.html#ref2_160898"><b>addSensor</b></a> , <a href="class139650.html#ref2_161282"><b>dump</b></a> , <a href="class139650.html#ref2_161666"><b>getPackageName</b></a> , <a href="class139650.html#ref2_161794"><b>getUid</b></a> , <a href="class139650.html#ref2_160642"><b>hasAnySensor</b></a> , <a href="class139650.html#ref2_160770"><b>hasOneShotSensors</b></a> , <a href="class139650.html#ref2_160514"><b>hasSensor</b></a> , <a href="class139650.html#ref2_161410"><b>needsWakeLock</b></a> , <a href="class139650.html#ref2_161026"><b>removeSensor</b></a> , <a href="class139650.html#ref2_161538"><b>resetWakeLockRefCount</b></a> , <a href="class139650.html#ref2_160386"><b>sendEvents</b></a> , <a href="class139650.html#ref2_161154"><b>setFirstFlushPending</b></a> , <a href="class139650.html#ref2_161922"><b>setSensorAccess</b></a> </p>
</body>
</html>
